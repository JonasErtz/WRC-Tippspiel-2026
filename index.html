<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WRC Saison Tippspiel</title>
<style>
body { font-family: Arial; max-width: 700px; margin: auto; text-align: center; }
input, select, button { margin: 5px; padding: 8px; width: 95%; }
h2 { margin-top: 30px; }
ul { text-align: left; }
.punkte-breakdown { font-size: 0.9em; color: #333; margin-left: 20px; }
.disabled { background-color: #ddd; }
</style>
</head>
<body>

<h1>üèÅ WRC Saison-Tippspiel</h1>
<p>W√§hle eine Rallye, trage deinen Namen ein und tippe!</p>

<select id="rallyeSelect"></select>
<br><br>

<input id="name" placeholder="Dein Name">

<h3>Endplatzierungen (Pl√§tze 1‚Äì5)</h3>
<select id="platz1"><option value="">Platz 1 w√§hlen</option></select>
<select id="platz2"><option value="">Platz 2 w√§hlen</option></select>
<select id="platz3"><option value="">Platz 3 w√§hlen</option></select>
<select id="platz4"><option value="">Platz 4 w√§hlen</option></select>
<select id="platz5"><option value="">Platz 5 w√§hlen</option></select>

<h3>Power Stage (Top 3)</h3>
<select id="ps1"><option value="">PS Platz 1 w√§hlen</option></select>
<select id="ps2"><option value="">PS Platz 2 w√§hlen</option></select>
<select id="ps3"><option value="">PS Platz 3 w√§hlen</option></select>

<h3>Erster Ausfall</h3>
<select id="ausfall"><option value="">Fahrer w√§hlen</option></select>

<button id="tipButton">Tipp abgeben</button>

<h2>üìä Rangliste (aktuelle Rallye)</h2>
<ul id="rangliste"></ul>

<h2>üèÜ Saison-Rangliste</h2>
<ul id="saisonRangliste"></ul>

<script>
// --- Konfiguration ---
const fahrer = ["Ogier","Rovanper√§","Neuville","Evans","Lappi","Suninen","Greensmith","T√§nak"];

// --- Rallyes ---
const rallyes = [
{ name: "Monte Carlo",
endplatz: ["Ogier","Rovanper√§","Neuville","Evans","Lappi"],
powerstage: ["Evans","Ogier","Rovanper√§"],
ausfall: "Greensmith",
rallyeStart: new Date("2026-03-01T10:00:00"),
powerstageStart: new Date("2026-03-01T15:00:00")
},
{ name: "Schweden",
endplatz: ["Rovanper√§","Evans","Ogier","Neuville","Lappi"],
powerstage: ["Ogier","Evans","Rovanper√§"],
ausfall: "Suninen",
rallyeStart: new Date("2026-03-08T10:00:00"),
powerstageStart: new Date("2026-03-08T15:00:00")
}
];

// --- Datenstruktur ---
let daten = []; // speichert alle Tipps pro Rallye inkl. Punkte

// --- Dropdowns f√ºllen ---
function dropdownFuellen(selectId) {
const select = document.getElementById(selectId);
fahrer.forEach(f => {
const option = document.createElement("option");
option.value = f;
option.text = f;
select.appendChild(option);
});
}

["platz1","platz2","platz3","platz4","platz5","ps1","ps2","ps3","ausfall"].forEach(dropdownFuellen);

// --- Rallye Auswahl ---
const rallyeSelect = document.getElementById("rallyeSelect");
rallyes.forEach((r,i)=>{
const option = document.createElement("option");
option.value = i;
option.text = r.name;
rallyeSelect.appendChild(option);
});
let aktuelleRallyeIndex = 0;
rallyeSelect.value = 0;

// --- Tipps abgeben ---
document.getElementById("tipButton").addEventListener("click", function() {
const now = new Date();
const rallye = rallyes[aktuelleRallyeIndex];

const allowEndplatz = now < rallye.rallyeStart;
const allowPowerStage = now < rallye.powerstageStart;

const name = document.getElementById("name").value.trim();
if(!name) { alert("Bitte Name eingeben!"); return; }

const tipps = [
document.getElementById("platz1").value,
document.getElementById("platz2").value,
document.getElementById("platz3").value,
document.getElementById("platz4").value,
document.getElementById("platz5").value
];
const psTipps = [
document.getElementById("ps1").value,
document.getElementById("ps2").value,
document.getElementById("ps3").value
];
const ausfallTipp = document.getElementById("ausfall").value;

if((allowEndplatz && tipps.includes("")) ||
(allowPowerStage && psTipps.includes("")) ||
(allowEndplatz && !ausfallTipp)) {
alert("Bitte alle Felder ausf√ºllen!");
return;
}

// Punkteberechnung
let breakdown = { platz: [], powerstage: [], ausfall: 0 };
let punkte = 0;

tipps.forEach((fahrerName,index)=>{
let punkt = 0;
if(fahrerName === rallye.endplatz[index]) punkt = (index===0) ? 7 : 5;
else if(rallye.endplatz.includes(fahrerName)) punkt = 2;
breakdown.platz.push({fahrer:fahrerName,punkte:punkt});
punkte += punkt;
});

psTipps.forEach((fahrerName,index)=>{
let punkt = 0;
if(fahrerName === rallye.powerstage[index]) punkt = 3;
else if(rallye.powerstage.includes(fahrerName)) punkt = 2;
breakdown.powerstage.push({fahrer:fahrerName,punkte:punkt});
punkte += punkt;
});

let ausfallPunkte = 0;
if(ausfallTipp === rallye.ausfall){ ausfallPunkte=3; punkte+=3; }
breakdown.ausfall = {fahrer:ausfallTipp,punkte:ausfallPunkte};

// Speichern
const existIndex = daten.findIndex(e => e.name===name && e.rallyeIndex===aktuelleRallyeIndex);
if(existIndex>=0) daten[existIndex] = { name, rallyeIndex:aktuelleRallyeIndex, punkte, breakdown };
else daten.push({ name, rallyeIndex:aktuelleRallyeIndex, punkte, breakdown });

anzeigen();
resetFields();
});

// --- Anzeige ---
function anzeigen(){
const rallye = rallyes[aktuelleRallyeIndex];
const liste = document.getElementById("rangliste");
liste.innerHTML="";
const rallyeTipps = daten.filter(e=>e.rallyeIndex===aktuelleRallyeIndex);
rallyeTipps.sort((a,b)=>b.punkte-a.punkte).forEach(spieler=>{
const li = document.createElement("li");
let text = `${spieler.name} ‚Äì ${spieler.punkte} Punkte`;
const details = document.createElement("div");
details.className="punkte-breakdown";

let platzText="Pl√§tze:\n";
spieler.breakdown.platz.forEach((p,i)=>{ platzText+=` ${i+1}. ${p.fahrer} ‚Üí ${p.punkte} Punkte\n`; });
let psText="Power Stage:\n";
spieler.breakdown.powerstage.forEach((p,i)=>{ psText+=` ${i+1}. ${p.fahrer} ‚Üí ${p.punkte} Punkte\n`; });
let ausfallText=`Erster Ausfall:\n ${spieler.breakdown.ausfall.fahrer} ‚Üí ${spieler.breakdown.ausfall.punkte} Punkte`;

details.textContent = platzText+psText+ausfallText;
li.textContent=text;
li.appendChild(details);
liste.appendChild(li);
});

// Saison-Rangliste
const saisonListe = document.getElementById("saisonRangliste");
saisonListe.innerHTML="";
const saisonPunkte = {};
daten.forEach(e=>{ saisonPunkte[e.name]=(saisonPunkte[e.name]||0)+e.punkte; });
Object.entries(saisonPunkte).sort((a,b)=>b[1]-a[1]).forEach(e=>{
const li=document.createElement("li");
li.textContent=`${e[0]} ‚Äì ${e[1]} Punkte`;
saisonListe.appendChild(li);
});
}

// --- Felder zur√ºcksetzen ---
function resetFields(){
const now = new Date();
const rallye = rallyes[aktuelleRallyeIndex];
const allowEndplatz = now<rallye.rallyeStart;
const allowPowerStage = now<rallye.powerstageStart;

document.getElementById("name").value="";
if(allowEndplatz) ["platz1","platz2","platz3","platz4","platz5","ausfall"].forEach(id=>document.getElementById(id).value="");
if(allowPowerStage) ["ps1","ps2","ps3"].forEach(id=>document.getElementById(id).value="");

["platz1","platz2","platz3","platz4","platz5","ausfall"].forEach(id=>{
document.getElementById(id).disabled=!allowEndplatz;
document.getElementById(id).className=!allowEndplatz?"disabled":"";
});
["ps1","ps2","ps3"].forEach(id=>{
document.getElementById(id).disabled=!allowPowerStage;
document.getElementById(id).className=!allowPowerStage?"disabled":"";
});
}

// Rallye wechseln
rallyeSelect.addEventListener("change", function(){
aktuelleRallyeIndex=parseInt(this.value);
resetFields();
anzeigen();
});

resetFields();
anzeigen();

</script>
</body>
</html>
