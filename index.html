<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WRC Tippspiel 2026</title>
<style>
body { font-family: Arial; max-width: 700px; margin: auto; text-align: center; }
input, select, button { margin: 5px; padding: 8px; width: 95%; }
h2 { margin-top: 30px; }
ul { text-align: left; }
.punkte-breakdown { font-size: 0.9em; color: #333; margin-left: 20px; white-space: pre-line; }
.disabled { background-color: #ddd; }
</style>
</head>
<body>

<h1>üèÅ WRC Tippspiel 2026</h1>
<p>W√§hle eine Rallye, trage deinen Namen ein und tippe!</p>

<select id="rallyeSelect"></select><br><br>
<input id="name" placeholder="Dein Name">

<h3>Endplatzierungen (Pl√§tze 1‚Äì5)</h3>
<select id="platz1"><option value="">Platz 1 w√§hlen</option></select>
<select id="platz2"><option value="">Platz 2 w√§hlen</option></select>
<select id="platz3"><option value="">Platz 3 w√§hlen</option></select>
<select id="platz4"><option value="">Platz 4 w√§hlen</option></select>
<select id="platz5"><option value="">Platz 5 w√§hlen</option></select>

<h3>Power Stage (Top 3)</h3>
<select id="ps1"><option value="">PS Platz 1 w√§hlen</option></select>
<select id="ps2"><option value="">PS Platz 2 w√§hlen</option></select>
<select id="ps3"><option value="">PS Platz 3 w√§hlen</option></select>

<h3>Erster Ausfall</h3>
<select id="ausfall"><option value="">Fahrer w√§hlen</option></select>

<button id="tipButton">Tipp abgeben</button>

<h2>üìä Rangliste (aktuelle Rallye)</h2>
<ul id="rangliste"></ul>

<h2>üèÜ Saison-Rangliste</h2>
<ul id="saisonRangliste"></ul>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// --- Firebase Config ---
const firebaseConfig = {
apiKey: "AIzaSyBx6XHMMhlWpJgyeK7veKQ8i-fNVu4ohYU",
authDomain: "wrc-tippspiel-2026.firebaseapp.com",
databaseURL: "https://wrc-tippspiel-2026-default-rtdb.europe-west1.firebasedatabase.app/",
projectId: "wrc-tippspiel-2026",
storageBucket: "wrc-tippspiel-2026.appspot.com",
messagingSenderId: "342694581633",
appId: "1:342694581633:web:133043efea71be6ddf8480"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Fahrer ---
const fahrer = ["Ogier","Evans","Neuville","Katsuta","Fourmaux","Pajari","Solberg","Munster","McErlean","Paddon","Armstrong","Sordo","Lappi","Sesks","Bertelli"];

// --- Rallyes 2026 ---
const rallyes = [
{ name:"Monte Carlo", endplatz:["Ogier","Rovanper√§","Neuville","Evans","Lappi"], powerstage:["Evans","Ogier","Rovanper√§"], ausfall:"Greensmith", rallyeStart:new Date("2026-01-22T10:00:00"), powerstageStart:new Date("2026-01-25T15:00:00") },
{ name:"Schweden", endplatz:["Rovanper√§","Evans","Ogier","Neuville","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"Suninen", rallyeStart:new Date("2026-02-12T10:00:00"), powerstageStart:new Date("2026-02-15T15:00:00") },
{ name:"Kenia", endplatz:["Ogier","Evans","Neuville","Rovanper√§","Lappi"], powerstage:["Evans","Ogier","Neuville"], ausfall:"Suninen", rallyeStart:new Date("2026-03-05T10:00:00"), powerstageStart:new Date("2026-03-08T15:00:00") },
{ name:"Kroatien", endplatz:["Rovanper√§","Ogier","Neuville","Evans","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-04-02T10:00:00"), powerstageStart:new Date("2026-04-05T15:00:00") },
{ name:"Gran Canaria", endplatz:["Neuville","Ogier","Rovanper√§","Evans","Lappi"], powerstage:["Ogier","Neuville","Evans"], ausfall:"Suninen", rallyeStart:new Date("2026-04-16T10:00:00"), powerstageStart:new Date("2026-04-19T15:00:00") },
{ name:"Portugal", endplatz:["Rovanper√§","Ogier","Evans","Neuville","Lappi"], powerstage:["Evans","Ogier","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-05-07T10:00:00"), powerstageStart:new Date("2026-05-10T15:00:00") },
{ name:"Japan", endplatz:["Ogier","Evans","Neuville","Rovanper√§","Lappi"], powerstage:["Evans","Ogier","Rovanper√§"], ausfall:"Suninen", rallyeStart:new Date("2026-05-28T10:00:00"), powerstageStart:new Date("2026-05-31T15:00:00") },
{ name:"Griechenland", endplatz:["Rovanper√§","Ogier","Evans","Neuville","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-06-18T10:00:00"), powerstageStart:new Date("2026-06-21T15:00:00") },
{ name:"Estland", endplatz:["Ogier","Rovanper√§","Evans","Neuville","Lappi"], powerstage:["Evans","Ogier","Rovanper√§"], ausfall:"Suninen", rallyeStart:new Date("2026-07-09T10:00:00"), powerstageStart:new Date("2026-07-12T15:00:00") },
{ name:"Finnland", endplatz:["Rovanper√§","Ogier","Neuville","Evans","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-07-30T10:00:00"), powerstageStart:new Date("2026-08-02T15:00:00") },
{ name:"Paraguay", endplatz:["Ogier","Evans","Neuville","Rovanper√§","Lappi"], powerstage:["Evans","Ogier","Neuville"], ausfall:"Suninen", rallyeStart:new Date("2026-09-03T10:00:00"), powerstageStart:new Date("2026-09-06T15:00:00") },
{ name:"Chile", endplatz:["Rovanper√§","Ogier","Evans","Neuville","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-09-24T10:00:00"), powerstageStart:new Date("2026-09-27T15:00:00") },
{ name:"Sardinien", endplatz:["Ogier","Rovanper√§","Evans","Neuville","Lappi"], powerstage:["Evans","Ogier","Rovanper√§"], ausfall:"Suninen", rallyeStart:new Date("2026-10-15T10:00:00"), powerstageStart:new Date("2026-10-18T15:00:00") },
{ name:"Saudi Arabien", endplatz:["Rovanper√§","Ogier","Evans","Neuville","Lappi"], powerstage:["Ogier","Evans","Rovanper√§"], ausfall:"T√§nak", rallyeStart:new Date("2026-11-05T10:00:00"), powerstageStart:new Date("2026-11-08T15:00:00") }
];

// --- JS Code f√ºr Dropdowns, Tipp abgeben, Punkte, Rangliste ---
document.addEventListener("DOMContentLoaded", function() {
["platz1","platz2","platz3","platz4","platz5","ps1","ps2","ps3","ausfall"].forEach(id=>{
const select = document.getElementById(id);
fahrer.forEach(f=>{
const option = document.createElement("option");
option.value=f; option.text=f; select.appendChild(option);
});
});

const rallyeSelect = document.getElementById("rallyeSelect");
rallyes.forEach((r,i)=>{
const option = document.createElement("option");
option.value=i; option.text=r.name;
rallyeSelect.appendChild(option);
});
rallyeSelect.value = 0;

let aktuelleRallyeIndex = 0;
resetFields();

rallyeSelect.addEventListener("change", function(){
aktuelleRallyeIndex = parseInt(this.value);
resetFields();
tippsHolen();
});

document.getElementById("tipButton").addEventListener("click", function(){
const name = document.getElementById("name").value.trim();
if(!name){ alert("Bitte Name eingeben!"); return; }

const tipps = ["platz1","platz2","platz3","platz4","platz5"].map(id=>document.getElementById(id).value);
const psTipps = ["ps1","ps2","ps3"].map(id=>document.getElementById(id).value);
const ausfallTipp = document.getElementById("ausfall").value;

if(tipps.includes("") || psTipps.includes("") || !ausfallTipp){ alert("Bitte alle Felder ausf√ºllen!"); return; }

const rallye = rallyes[aktuelleRallyeIndex];
let punkte = 0;
let breakdown = { platz: [], powerstage: [], ausfall: 0 };

// Endplatzierungen
tipps.forEach((f,i)=>{
let p=0;
if(f===rallye.endplatz[i]) p=(i===0)?7:5;
else if(rallye.endplatz.includes(f)) p=2;
breakdown.platz.push({fahrer:f,punkte:p});
punkte+=p;
});

// Power Stage
psTipps.forEach((f,i)=>{
let p=0;
if(f===rallye.powerstage[i]) p=3;
else if(rallye.powerstage.includes(f)) p=2;
breakdown.powerstage.push({fahrer:f,punkte:p});
punkte+=p;
});

// Erster Ausfall
let ausfallP=0;
if(ausfallTipp===rallye.ausfall){ ausfallP=3; punkte+=3; }
breakdown.ausfall={fahrer:ausfallTipp,punkte:ausfallP};

db.ref('tipps/'+aktuelleRallyeIndex+'/'+name).set({punkte,breakdown});
});

tippsHolen();
});

function tippsHolen(){
const rallyeSelect = document.getElementById("rallyeSelect");
const aktuelleRallyeIndex = parseInt(rallyeSelect.value);
db.ref('tipps/'+aktuelleRallyeIndex).on('value', snapshot=>{
const daten = snapshot.val()||{};
anzeigen(daten);
anzeigenSaison();
});
}

function anzeigen(daten){
const liste = document.getElementById("rangliste");
liste.innerHTML="";
const now = new Date();
const rallyeSelect = document.getElementById("rallyeSelect");
const aktuelleRallyeIndex = parseInt(rallyeSelect.value);
const rallye = rallyes[aktuelleRallyeIndex];
const ownName = document.getElementById("name").value.trim();

Object.entries(daten).forEach(([name,val])=>{
if(now>rallye.rallyeStart || name===ownName){
const li = document.createElement("li");
li.textContent=`${name} ‚Äì ${val.punkte} Punkte`;
const details = document.createElement("div");
details.className="punkte-breakdown";
let text = "Pl√§tze:\n";
val.breakdown.platz.forEach((p,i)=>{ text+=` ${i+1}. ${p.fahrer} ‚Üí ${p.punkte} Punkte\n`; });
text+="Power Stage:\n";
val.breakdown.powerstage.forEach((p,i)=>{ text+=` ${i+1}. ${p.fahrer} ‚Üí ${p.punkte} Punkte\n`; });
text+="Erster Ausfall:\n";
text+=` ${val.breakdown.ausfall.fahrer} ‚Üí ${val.breakdown.ausfall.punkte} Punkte`;
details.textContent=text;
li.appendChild(details);
liste.appendChild(li);
}
});
}

function anzeigenSaison(){
const saisonListe = document.getElementById("saisonRangliste");
saisonListe.innerHTML="";
const punkteMap={};
rallyes.forEach((r,i)=>{
db.ref('tipps/'+i).once('value', snap=>{
const rDaten=snap.val()||{};
Object.entries(rDaten).forEach(([name,val])=>{
punkteMap[name]=(punkteMap[name]||0)+val.punkte;
});
saisonListe.innerHTML="";
Object.entries(punkteMap).sort((a,b)=>b[1]-a[1]).forEach(e=>{
const li=document.createElement("li");
li.textContent=`${e[0]} ‚Äì ${e[1]} Punkte`;
saisonListe.appendChild(li);
});
});
});
}

function resetFields(){
["platz1","platz2","platz3","platz4","platz5","ps1","ps2","ps3","ausfall"].forEach(id=>{
document.getElementById(id).value="";
document.getElementById(id).disabled=false;
document.getElementById(id).className="";
});
document.getElementById("name").value="";
}
</script>
</body>
</html>
