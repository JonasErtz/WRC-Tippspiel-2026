<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WRC Tippspiel 2026</title>
<style>
body { font-family: Arial; max-width: 700px; margin: auto; text-align: center; }
input, select, button { margin: 5px; padding: 8px; width: 95%; }
h2 { margin-top: 30px; }
ul { text-align: left; }
.punkte-breakdown { font-size: 0.9em; color: #333; margin-left: 20px; white-space: pre-line; }
.disabled { background-color: #ddd; }
</style>
</head>
<body>

<h1>ğŸ WRC Tippspiel 2026</h1>
<p>WÃ¤hle eine Rallye und tippe!</p>

<select id="rallyeSelect"></select><br><br>
<input id="name" placeholder="Dein Name">

<h3>Endplatzierungen (PlÃ¤tze 1â€“5)</h3>
<select id="platz1"><option value="">Platz 1 wÃ¤hlen</option></select>
<select id="platz2"><option value="">Platz 2 wÃ¤hlen</option></select>
<select id="platz3"><option value="">Platz 3 wÃ¤hlen</option></select>
<select id="platz4"><option value="">Platz 4 wÃ¤hlen</option></select>
<select id="platz5"><option value="">Platz 5 wÃ¤hlen</option></select>

<h3>Power Stage (Top 3)</h3>
<select id="ps1"><option value="">PS Platz 1 wÃ¤hlen</option></select>
<select id="ps2"><option value="">PS Platz 2 wÃ¤hlen</option></select>
<select id="ps3"><option value="">PS Platz 3 wÃ¤hlen</option></select>

<h3>Erster Ausfall</h3>
<select id="ausfall"><option value="">Fahrer wÃ¤hlen</option></select>

<button id="tipButton">Tipp abgeben</button>

<h2>ğŸ“Š Rangliste (aktuelle Rallye)</h2>
<ul id="rangliste"></ul>

<h2>ğŸ† Saison-Rangliste</h2>
<ul id="saisonRangliste"></ul>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// ===================== ANMELDUNG =====================
let currentUser = localStorage.getItem("wrcName");

document.addEventListener("DOMContentLoaded", () => {
if(currentUser){
document.getElementById("name").value = currentUser;
document.getElementById("name").disabled = true;
}
});

// ===================== FIREBASE =====================
firebase.initializeApp({
apiKey: "AIzaSyBx6XHMMhlWpJgyeK7veKQ8i-fNVu4ohYU",
authDomain: "wrc-tippspiel-2026.firebaseapp.com",
databaseURL: "https://wrc-tippspiel-2026-default-rtdb.europe-west1.firebasedatabase.app/",
projectId: "wrc-tippspiel-2026",
storageBucket: "wrc-tippspiel-2026.appspot.com",
messagingSenderId: "342694581633",
appId: "1:342694581633:web:133043efea71be6ddf8480"
});
const db = firebase.database();

// ===================== FAHRER =====================
const fahrer = ["Ogier","Evans","Neuville","Katsuta","Fourmaux","Pajari","Solberg","Munster","McErlean","Paddon","Armstrong","Sordo","Lappi","Sesks","Bertelli"];

// ===================== RALLYES =====================
const rallyes = [
{ name:"Monte Carlo", rallyeStart:Date.UTC(2026,0,22,10,0,0), powerstageStart:Date.UTC(2026,0,25,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Schweden", rallyeStart:Date.UTC(2026,1,9,13,21,0), powerstageStart:Date.UTC(2026,1,9,13,25,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Kenia", rallyeStart:Date.UTC(2026,2,5,10,0,0), powerstageStart:Date.UTC(2026,2,8,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Kroatien", rallyeStart:Date.UTC(2026,3,2,10,0,0), powerstageStart:Date.UTC(2026,3,5,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Gran Canaria", rallyeStart:Date.UTC(2026,3,16,10,0,0), powerstageStart:Date.UTC(2026,3,19,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Portugal", rallyeStart:Date.UTC(2026,4,7,10,0,0), powerstageStart:Date.UTC(2026,4,10,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Japan", rallyeStart:Date.UTC(2026,4,28,10,0,0), powerstageStart:Date.UTC(2026,4,31,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Griechenland", rallyeStart:Date.UTC(2026,5,18,10,0,0), powerstageStart:Date.UTC(2026,5,21,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Estland", rallyeStart:Date.UTC(2026,6,9,10,0,0), powerstageStart:Date.UTC(2026,6,12,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Finnland", rallyeStart:Date.UTC(2026,6,30,10,0,0), powerstageStart:Date.UTC(2026,7,2,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Paraguay", rallyeStart:Date.UTC(2026,8,3,10,0,0), powerstageStart:Date.UTC(2026,8,6,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Chile", rallyeStart:Date.UTC(2026,8,24,10,0,0), powerstageStart:Date.UTC(2026,8,27,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Sardinien", rallyeStart:Date.UTC(2026,9,15,10,0,0), powerstageStart:Date.UTC(2026,9,18,15,0,0), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Saudi Arabien", rallyeStart:Date.UTC(2026,10,5,10,0,0), powerstageStart:Date.UTC(2026,10,8,15,0,0), endplatz:[], powerstage:[], ausfall:"" }
];

// ===================== DROPDOWNS =====================
["platz1","platz2","platz3","platz4","platz5","ps1","ps2","ps3","ausfall"].forEach(id=>{
const select=document.getElementById(id);
fahrer.forEach(f=>{
const o=document.createElement("option");
o.value=f; o.text=f;
select.appendChild(o);
});
});

rallyes.forEach((r,i)=>{
const o=document.createElement("option");
o.value=i; o.text=r.name;
rallyeSelect.appendChild(o);
});

// ===================== TIPP ABGEBEN =====================
tipButton.onclick=()=>{
let name=document.getElementById("name").value.trim();
if(!name) return alert("Bitte Name eingeben");

if(!currentUser){
localStorage.setItem("wrcName", name);
currentUser=name;
document.getElementById("name").disabled=true;
}

const tipps=["platz1","platz2","platz3","platz4","platz5"].map(id=>document.getElementById(id).value);
const ps=["ps1","ps2","ps3"].map(id=>document.getElementById(id).value);
const ausfall=document.getElementById("ausfall").value;
if(tipps.includes("")||ps.includes("")||!ausfall) return alert("Alles ausfÃ¼llen");

db.ref("tipps/"+rallyeSelect.value+"/"+name).set({ tipps, ps, ausfall });
};

// ===================== ANZEIGE =====================
function anzeigen(){
const idx=rallyeSelect.value;
const rallye=rallyes[idx];
const now=Date.now();
rangliste.innerHTML="";

db.ref("tipps/"+idx).on("value",snap=>{
const daten=snap.val()||{};
Object.entries(daten).forEach(([name,val])=>{
const showPlatz = now>=rallye.rallyeStart || name===currentUser;
const showPS = now>=rallye.powerstageStart || name===currentUser;
if(!showPlatz) return;

let p=0, txt="";

val.tipps.forEach((f,i)=>{
let pts=(i===0)?7:5;
p+=pts;
txt+=`Platz ${i+1}: ${f} â†’ ${pts} Punkte\n`;
});

if(showPS){
val.ps.forEach((f,i)=>{
p+=3;
txt+=`PS ${i+1}: ${f} â†’ 3 Punkte\n`;
});
} else {
txt+="Power Stage: â³ noch gesperrt\n";
}

p+=3;
txt+=`Ausfall: ${val.ausfall} â†’ 3 Punkte`;

rangliste.innerHTML+=`<li><strong>${name} â€“ ${p} Punkte</strong><div class="punkte-breakdown">${txt}</div></li>`;
});
});
}

rallyeSelect.onchange=anzeigen;
anzeigen();
</script>

</body>
</html>