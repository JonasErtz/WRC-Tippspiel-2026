<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WRC Tippspiel 2026</title>
<style>
body { font-family: Arial; max-width: 800px; margin: auto; text-align: center; }
input, select, button { margin: 5px; padding: 8px; width: 95%; }
h2 { margin-top: 30px; }
ul { text-align: left; }
.punkte-breakdown { font-size: 0.9em; color: #333; margin-left: 20px; white-space: pre-line; }
.disabled { background-color: #ddd; }
.login { background:#f4f4f4; padding:15px; border-radius:8px; }
</style>
</head>

<body>

<h1>ğŸ WRC Tippspiel 2026</h1>

<div id="loginBox" class="login">
<h3>ğŸ‘¤ Anmeldung</h3>
<input id="loginName" placeholder="Dein Name">
<button onclick="login()">Anmelden</button>
</div>

<p id="welcome" style="display:none;"></p>

<select id="rallyeSelect"></select>

<h3>Endplatzierungen (PlÃ¤tze 1â€“5)</h3>
<select id="platz1"></select>
<select id="platz2"></select>
<select id="platz3"></select>
<select id="platz4"></select>
<select id="platz5"></select>

<h3>Power Stage (Top 3)</h3>
<select id="ps1"></select>
<select id="ps2"></select>
<select id="ps3"></select>

<h3>Erster Ausfall</h3>
<select id="ausfall"></select>

<button id="tipButton">Tipp abgeben</button>

<h2>ğŸ“Š Rangliste (aktuelle Rallye)</h2>
<ul id="rangliste"></ul>

<h2>ğŸ† Saison-Rangliste</h2>
<ul id="saisonRangliste"></ul>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
/* ---------------- LOGIN ---------------- */
let currentUser = localStorage.getItem("wrcName");

function login(){
const name = document.getElementById("loginName").value.trim();
if(!name){ alert("Bitte Namen eingeben"); return; }
localStorage.setItem("wrcName", name);
location.reload();
}

if(currentUser){
document.getElementById("loginBox").style.display="none";
document.getElementById("welcome").style.display="block";
document.getElementById("welcome").textContent = "Angemeldet als: " + currentUser;
}

/* ------------- FIREBASE ---------------- */
const firebaseConfig = {
apiKey: "AIzaSyBx6XHMMhlWpJgyeK7veKQ8i-fNVu4ohYU",
authDomain: "wrc-tippspiel-2026.firebaseapp.com",
databaseURL: "https://wrc-tippspiel-2026-default-rtdb.europe-west1.firebasedatabase.app/",
projectId: "wrc-tippspiel-2026",
storageBucket: "wrc-tippspiel-2026.appspot.com",
messagingSenderId: "342694581633",
appId: "1:342694581633:web:133043efea71be6ddf8480"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ------------- DATEN ---------------- */
const fahrer = ["Ogier","Evans","Neuville","Katsuta","Fourmaux","Pajari","Solberg","Munster","McErlean","Paddon","Armstrong","Sordo","Lappi","Sesks","Bertelli"];

const rallyes = [
{ name:"Monte Carlo", rallyeStart:Date.UTC(2026,0,22,10), powerstageStart:Date.UTC(2026,0,25,15), endplatz:[], powerstage:[], ausfall:"" },
{ name:"Schweden", rallyeStart:Date.UTC(2026,1,9,10), powerstageStart:Date.UTC(2026,1,12,15), endplatz:[], powerstage:[], ausfall:"" }
];

/* ----------- DROPDOWNS ---------------- */
["platz1","platz2","platz3","platz4","platz5","ps1","ps2","ps3","ausfall"].forEach(id=>{
const s=document.getElementById(id);
s.innerHTML='<option value="">Bitte wÃ¤hlen</option>';
fahrer.forEach(f=>s.innerHTML+=`<option>${f}</option>`);
});

rallyes.forEach((r,i)=>{
rallyeSelect.innerHTML+=`<option value="${i}">${r.name}</option>`;
});

/* ------------ TIPPS SPEICHERN ---------- */
tipButton.onclick=()=>{
if(!currentUser){ alert("Bitte anmelden"); return; }

const idx=rallyeSelect.value;
const rallye=rallyes[idx];

const tipps=["platz1","platz2","platz3","platz4","platz5"].map(id=>document.getElementById(id).value);
const ps=["ps1","ps2","ps3"].map(id=>document.getElementById(id).value);
const ausfall=document.getElementById("ausfall").value;

if(tipps.includes("")||ps.includes("")||!ausfall){
alert("Bitte alles ausfÃ¼llen"); return;
}

db.ref(`tipps/${idx}/${currentUser}`).set({
platz:tipps,
powerstage:ps,
ausfall
});
};

/* ----------- ANZEIGE ------------------- */
function anzeigen(){
const idx=rallyeSelect.value;
const rallye=rallyes[idx];
const now=Date.now();

db.ref(`tipps/${idx}`).on("value",snap=>{
rangliste.innerHTML="";
const daten=snap.val()||{};

Object.entries(daten).forEach(([name,tip])=>{
const showPlatz = now>=rallye.rallyeStart || name===currentUser;
const showPS = now>=rallye.powerstageStart || name===currentUser;

if(!showPlatz) return;

let li=document.createElement("li");
li.innerHTML=`<strong>${name}</strong><div class="punkte-breakdown">
PlÃ¤tze: ${tip.platz.join(", ")}
Ausfall: ${tip.ausfall}
Power Stage: ${showPS ? tip.powerstage.join(", ") : "â³ gesperrt"}
</div>`;
rangliste.appendChild(li);
});
});
}

rallyeSelect.onchange=anzeigen;
anzeigen();
</script>

</body>
</html>